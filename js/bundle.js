"use strict";angular.module("cppSlideApp",[]),angular.module("cppSlideApp").config(["$locationProvider",function(e){e.html5Mode(!0)}]),angular.module("cppSlideApp").controller("SlideCtrl",["$scope","$timeout","TumblrPosts",function(e,t,i){i.getAllPhotoPosts().then(function(t){e.slides=t})}]),angular.module("cppSlideApp").directive("initSlideshow",["$interval","$location","$timeout",function(e,t,i){function n(){$(".image img").fullscreenslides();var i=$("#fullscreenSlideshowContainer");i.bind("init",function(){i.append('<div class="ui" id="fs-close">&times;</div>').append('<div class="ui" id="fs-loader">Loading...</div>').append('<div class="ui" id="fs-prev">&lt;</div>').append('<div class="ui" id="fs-next">&gt;</div>').append('<div class="ui" id="fs-caption"><span></span></div>'),$("#fs-prev").click(function(){i.trigger("prevSlide")}),$("#fs-next").click(function(){i.trigger("nextSlide")}),$("#fs-close").click(function(){i.trigger("close")})}).bind("startLoading",function(){$("#fs-loader").show()}).bind("stopLoading",function(){$("#fs-loader").hide()}).bind("startOfSlide",function(e,t){$("#fs-caption span").html(t.title),$("#fs-caption").show()}).bind("endOfSlide",function(e,t){$("#fs-caption").hide()}),$(".image a").first().trigger("click");var n=t.search().t||1e4;e(function(){i.trigger("nextSlide")},n)}return function(e,t,l){e.$last&&i(n)}}]),angular.module("cppSlideApp").factory("TumblrPosts",["$http","$q",function(e,t){function i(t){var i=o+a+"/posts/photo";return e.jsonp(i,{params:{api_key:r,callback:"JSON_CALLBACK",offset:t}})}function n(e){return e.map(function(e){var t=e.photos[0];return{caption:e.caption,summary:e.summary,photo:t.alt_sizes[0].url,photo_small:t.alt_sizes[Math.max(0,t.alt_sizes.length-3)].url}})}function l(){return t(function(e){function t(){i(l.length).then(function(i){i=i.data.response,l=l.concat(n(i.posts)),l.length<i.total_posts?t():e(l)})}var l=[];t()})}var r="cwfAs4YdGYRFJwa93IdlKJYLeuAnjWhT54nUg2qVceXqdJzUA9",o="https://api.tumblr.com/v2/blog/",a="classicprogrammerpaintings.com";return{getAllPhotoPosts:l}}]),function(e){var t,i=function(){function i(e){t.data("isFullScreen")&&t.trigger("close"),t.data("isFullScreen",!0)}t.bind("updateSize orientationchange",function(i){t.height(e(window).height()),n()});var n=function(i){if(void 0===i)var i=t.data("currentSlide");if(i&&i.$img){var n=e(window).height(),l=e(window).width();l/n>i.$img.width()/i.$img.height()?i.$img.css({height:n+"px",width:"auto"}):i.$img.css({height:"auto",width:l+"px"}),i.$img.css({"margin-left":"-"+.5*i.$img.width()+"px","margin-top":"-"+.5*i.$img.height()+"px"})}};e(window).bind("resize",function(){t.trigger("updateSize")});var l=!1;t.bind("showSlide",function(i,o){if(!l){var a=t.data("currentSlide");"$img"in o?r(a,o):(l=!0,t.trigger("startLoading"),o.$img=e('<img class="slide">').css({position:"absolute",left:"50%",top:"50%"}).hide().load(function(){l=!1,t.trigger("stopLoading"),n(o),r(a,o)}).error(function(){l=!1,o.error=!0,t.trigger("stopLoading").trigger("error",o)}).attr("src",o.image),t.append(o.$img))}}),t.bind("prevSlide nextSlide",function(e){var i,n=t.data("slides"),l=t.data("currentSlide"),r=l&&l.id||0;i="nextSlide"==e.type?(r+1)%n.length:(r-1+n.length)%n.length,t.trigger("showSlide",n[i])});var r=function(e,i){void 0!==e&&(t.trigger("endOfSlide",e),e.$img.fadeOut()),i.$img&&!i.error?i.$img.fadeIn(function(){t.trigger("startOfSlide",i)}):t.trigger("startOfSlide",i),t.data("currentSlide",i)},o=function(e){27==e.keyCode&&t.trigger("close"),37==e.keyCode&&t.trigger("prevSlide"),39==e.keyCode&&t.trigger("nextSlide")};t.bind("close",function(){var n=t.data("options"),l=t.data("currentSlide");l&&l.$img&&l.$img.hide(),t.trigger("endOfSlide",l),e(document).unbind("keydown",o),n.useFullScreen?(document.cancelFullScreen&&document.cancelFullScreen(),document.mozCancelFullScreen&&(e("html").css("overflow","auto"),e(document).scrollTop(t.data("mozScrollTop")),document.mozCancelFullScreen()),document.webkitCancelFullScreen&&document.webkitCancelFullScreen(),document.removeEventListener("fullscreenchange",i),document.removeEventListener("mozfullscreenchange",i),document.removeEventListener("webkitfullscreenchange",i)):(t.data("hiddenElements").show(),e(window).scrollTop(t.data("originalScrollTop"))),t.removeData("currentSlide slides width height originalScrollTop hiddenElements").hide()});var a=!0;t.bind("show",function(n,l,r){var d=t.data("options"),s=t.data("slideshows"),c=s[l];if(t.data("slides",c),t.trigger("updateSize"),e(document).bind("keydown",o),d.useFullScreen){var u=t[0];u.requestFullScreen&&(u.requestFullScreen(),document.addEventListener("fullscreenchange",i)),u.mozRequestFullScreen&&(u.mozRequestFullScreen(),document.addEventListener("mozfullscreenchange",i),t.data("mozScrollTop",e(document).scrollTop()),e("html").css("overflow","hidden")),u.webkitRequestFullScreen&&(u.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT),document.addEventListener("webkitfullscreenchange",i)),t.data("isFullScreen",!1)}a&&(t.trigger("init"),a=!1),d.useFullScreen||t.data("hiddenElements",e("body > *").filter(function(){return"none"!=e(this).css("display")}).hide()),t.data("originalScrollTop")||t.data("originalScrollTop",e(window).scrollTop()),t.show(),t.trigger("showSlide",r)})};e.fn.fullscreenslides=function(n){t=e("#fullscreenSlideshowContainer"),0==t.length&&(t=e('<div id="fullscreenSlideshowContainer">').hide(),e("body").append(t),i());var n=e.extend({bgColor:"#000",useFullScreen:!0,startSlide:0},n||{});n.useFullScreen=n.useFullScreen&&!!(t[0].requestFullScreen||t[0].mozRequestFullScreen||t[0].webkitRequestFullScreen),t.data("options",n),t.css({position:"absolute",top:"0px",left:"0px",width:"100%","text-align":"center","background-color":n.bgColor});var l={};this.each(function(){var i=e(this).parents("a")[0];i.rel||i.setAttribute("rel","__all__");var n={image:i.href,title:i.title,rel:i.rel};n.data=e.extend({},e(this).data(),e(i).data()),l[n.rel]=l[n.rel]||[],l[n.rel].push(n),n.id=l[n.rel].length-1,e(i).data("slide",n),e(i).click(function(i){t.trigger("show",[this.rel,e(this).data("slide")]),i.preventDefault()})}),t.data("slideshows",l)}}(jQuery);